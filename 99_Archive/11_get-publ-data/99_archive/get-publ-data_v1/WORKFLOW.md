# 자동화 워크플로우 문서

이 문서는 publ.biz 로그인 자동화 스크립트가 수행하는 전체 작업 흐름을 설명합니다.

## 📋 개요

이 자동화 스크립트는 Playwright를 사용하여 publ.biz 콘솔에 자동으로 로그인하고, 멤버 목록 CSV 파일을 다운로드하는 전체 프로세스를 자동화합니다.

**워크플로우 구조**: 각 목표 단위로 구성되며, 브라우저 유지는 항상 마지막 단계로 실행됩니다.

## 🔄 전체 워크플로우

### 1. 초기화 및 환경 설정

**목표**: 브라우저 실행 및 다운로드 환경 준비

**수행 작업**:
- Chromium 브라우저 실행 (헤드리스 모드: 비활성화)
- 브라우저 창 크기 설정 (1280x800)
- 다운로드 경로 설정 (`./downloads` 폴더)
- 다운로드 폴더 자동 생성 (없는 경우)
- 다운로드 동작 설정 (CDP를 통한 설정)

**예상 소요 시간**: 약 2초

**로그 출력 예시**:
```
브라우저 시작 중...
✓ 브라우저가 시작되었습니다.
✓ 다운로드 경로 설정: /path/to/downloads
✓ 다운로드 동작 설정 완료
✓ 브라우저 창 크기 조정 완료 (1280x800)
```

---

### 2. 로그인하기

**목표**: publ.biz 콘솔에 자동으로 로그인하여 인증된 세션 획득

#### 2-1. 로그인 정보 확인

**수행 작업**:
- `.env` 파일에서 `PUBL_EMAIL` 및 `PUBL_PASSWORD` 읽기
- 명령줄 인자 확인 (환경변수가 없는 경우)
- 로그인 정보 유효성 검증
- 보안을 위한 마스킹 처리된 정보 출력

**예상 소요 시간**: 즉시

**로그 출력 예시**:
```
🔍 환경변수 확인:
  - EMAIL: ✓ 설정됨 (26자)
  - EMAIL 값: cmd***com
  - PASSWORD: ✓ 설정됨 (14자)
  - PASSWORD 값: Ya***z1
```

**에러 처리**:
- 이메일 또는 비밀번호가 없으면 오류 메시지 출력 후 종료

#### 2-2. 로그인 페이지 접속

**수행 작업**:
- 새 페이지 생성
- `https://console.publ.biz/?type=enter` URL로 이동
- 페이지 로드 대기 (`domcontentloaded` 상태까지)
- 로그인 폼 요소가 나타날 때까지 대기

**예상 소요 시간**: 약 3초

**로그 출력 예시**:
```
✓ 새 페이지가 생성되었습니다.
publ.biz 로그인 페이지로 이동 중...
✓ 페이지 이동 완료
페이지 로드 대기 중...
✓ 로그인 폼이 로드되었습니다.
```

**에러 처리**:
- 페이지 로드 타임아웃 시 경고 메시지 출력 후 계속 진행
- 로그인 폼을 찾을 수 없으면 스크린샷 저장 (`page-load-screenshot.png`)

#### 2-3. 로그인 정보 입력

**수행 작업**:

**이메일 입력**:
- 여러 선택자로 이메일 필드 찾기 시도:
  - `input[name="email"]`
  - `input[placeholder="E-mail"]`
  - `input[type="text"][placeholder*="mail" i]`
- 필드 클릭하여 포커스
- 기존 값 전체 선택 및 삭제 (Command+A → Backspace)
- 새 이메일 값 입력
- 입력 확인 및 검증

**비밀번호 입력**:
- 여러 선택자로 비밀번호 필드 찾기 시도:
  - `input[name="password"][type="password"]`
  - `input[type="password"][placeholder="Password"]`
  - `input[type="password"]:not([name="removePassword"])`
- 필드 클릭하여 포커스
- 기존 값 전체 선택 및 삭제
- 새 비밀번호 값 입력
- 입력 확인 및 검증

**예상 소요 시간**: 약 1초

**로그 출력 예시**:
```
로그인 정보 입력 중...
  - 이메일 필드 찾기 시도: input[name="email"]
✓ 이메일 입력 완료 (26자 입력됨)
  입력된 값: cmd***com
  - 비밀번호 필드 찾기 시도: input[name="password"][type="password"]
✓ 비밀번호 입력 완료 (14자 입력됨)
  입력된 값: Ya***z1
```

**에러 처리**:
- 이메일 필드를 찾을 수 없으면 페이지의 모든 input 요소 정보 출력 후 오류 발생
- 비밀번호 필드를 찾을 수 없으면 오류 발생

#### 2-4. 로그인 버튼 클릭

**수행 작업**:
- 여러 선택자로 로그인 버튼 찾기 시도:
  - `button[type="submit"]:has-text("Login")`
  - `button:has-text("Login")`
  - `button[type="submit"]`
- 버튼 활성화 상태 확인
- 버튼 클릭

**예상 소요 시간**: 약 0.5초

**로그 출력 예시**:
```
  - 로그인 버튼 찾기 시도: button[type="submit"]:has-text("Login")
  - 버튼 활성화 상태: true
✓ 로그인 버튼 클릭 완료
```

**에러 처리**:
- 로그인 버튼을 찾을 수 없으면 페이지의 모든 button 요소 정보 출력 후 오류 발생

#### 2-5. 로그인 결과 확인

**수행 작업**:
- URL 변경 대기 (최대 15초)
- 현재 URL 확인
- 에러 메시지 검색:
  - 다양한 선택자로 에러 요소 찾기
  - 페이지 텍스트에서 에러 키워드 검색 (`error`, `잘못`, `실패`, `incorrect`, `invalid`, `failed`)
- 로그인 폼 존재 여부 확인 (추가 검증)

**예상 소요 시간**: 약 3초

**로그 출력 예시 (성공)**:
```
로그인 처리 중...
초기 URL: https://console.publ.biz/?type=enter
현재 URL: https://console.publ.biz/all-channels?page=1&limit=15&markChannelAs=RUNNING
✅ 로그인 성공!
```

**로그 출력 예시 (실패)**:
```
❌ 로그인 실패: Your e-mail and/or password is incorrect. Please try again. (401)
```

**에러 처리**:
- 에러 메시지가 발견되면 오류 출력
- URL이 로그인 페이지에서 변경되지 않으면 경고 메시지 출력

---

### 3. 회원 정보 CSV 파일 다운로드

**목표**: 멤버 목록 페이지에서 CSV 파일을 다운로드하여 로컬에 저장

#### 3-1. 목표 페이지로 이동

**수행 작업**:
- 목표 URL로 이동: `https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/members/registered-users`
- 페이지 로드 대기 (`domcontentloaded` 상태까지)
- 최종 URL 확인
- 로그인 세션 만료 여부 확인
- 페이지 도달 여부 검증

**예상 소요 시간**: 약 2초

**로그 출력 예시**:
```
지정된 페이지로 이동 중...
목표 URL: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/members/registered-users
현재 페이지: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/members/registered-users
✓ 목표 페이지에 성공적으로 도달했습니다.
✓ 목표 페이지 확인 완료. 다운로드 버튼을 찾습니다.
```

**에러 처리**:
- 로그인 페이지로 리다이렉트되면 경고 메시지 출력
- 목표 페이지에 도달하지 못하면 재시도 또는 건너뛰기

#### 3-2. 다운로드 버튼 찾기 및 클릭

**수행 작업**:

**페이지 요소 분석**:
- 페이지의 모든 버튼/링크 요소 수집
- 다운로드 관련 키워드로 필터링:
  - `download`, `다운로드`, `export`, `내보내기`, `csv`, `excel`, `xlsx`, `xls`
- 잠재적 다운로드 버튼 목록 출력

**다운로드 버튼 찾기**:
- 다양한 선택자로 다운로드 버튼 찾기 시도:
  - `button:has-text("Download")`
  - `button:has-text("다운로드")`
  - `button:has-text("CSV")`
  - `button:has-text("Excel")`
  - `a:has-text("Download")`
  - `[download]` 속성
  - `button[aria-label*="download" i]`
  - 기타 다운로드 관련 선택자

**다운로드 실행**:
- 버튼이 보이는지 확인
- 버튼이 보이지 않으면 스크롤
- 다운로드 이벤트 대기와 버튼 클릭 동시 실행
- 다운로드 이벤트 감지

**예상 소요 시간**: 약 2초

**로그 출력 예시**:
```
다운로드 버튼 찾는 중...
페이지 제목: [페이지 제목]
페이지 URL: [URL]
발견된 버튼/링크 수: [숫자]

다운로드 가능한 버튼 발견:
  1. [BUTTON] "All Member download (CSV)" (visible: true)

✓ 다운로드 버튼 발견: "All Member download (CSV)" (선택자: button:has-text("CSV"))
✓ 다운로드 버튼 클릭 완료
```

**에러 처리**:
- 다운로드 버튼을 찾을 수 없으면 페이지의 주요 버튼 목록 출력
- 다운로드 이벤트를 감지하지 못하면 다운로드 폴더 확인 (최근 10초 내 생성된 파일)

#### 3-3. 파일 저장

**수행 작업**:
- 다운로드 이벤트에서 제안된 파일명 가져오기
- 파일명에 타임스탬프 추가 (형식: `YYYY-MM-DDTHH-MM-SS`)
- 파일 확장자 추출
- 새 파일명 생성: `[원본파일명]_[타임스탬프].[확장자]`
- `./downloads` 폴더에 저장

**예상 소요 시간**: 즉시

**파일명 예시**:
- 원본: `All member list_251122.csv`
- 저장: `All member list_251122_2024-11-22T13-45-30.csv`

**로그 출력 예시**:
```
✅ 파일 다운로드 완료: /path/to/downloads/All member list_251122_2024-11-22T13-45-30.csv
```

**에러 처리**:
- 다운로드 이벤트를 감지하지 못한 경우, 다운로드 폴더에서 최근 생성된 파일 확인

---

### 4. 주문 목록 CSV 파일 다운로드

**목표**: 주문 목록 첫번째 페이지와 마지막 페이지에서 CSV 파일을 다운로드하여 로컬에 저장

#### 4-1. 첫번째 페이지로 이동

**수행 작업**:
- 목표 URL로 이동: `https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page=1&limit=300`
- 페이지 로드 대기 (`domcontentloaded` 상태까지)
- 최종 URL 확인
- 로그인 세션 만료 여부 확인
- 페이지 도달 여부 검증

**예상 소요 시간**: 약 2초

**로그 출력 예시**:
```
[4-1] 주문 목록 첫번째 페이지로 이동 중...
목표 URL: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page=1&limit=300
현재 페이지: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page=1&limit=300
✓ 첫번째 페이지에 성공적으로 도달했습니다.
```

**에러 처리**:
- 로그인 페이지로 리다이렉트되면 경고 메시지 출력 후 종료
- 목표 페이지에 도달하지 못하면 경고 메시지 출력 후 종료

#### 4-2. 마지막 페이지 번호 찾기

**수행 작업**:
- 4가지 방법을 순차적으로 시도하여 마지막 페이지 번호 찾기:
  - **방법 1**: 특정 CSS 클래스로 페이지 번호 요소 찾기
    - `[class*="sc-epOimh"]`, `[class*="jJQXSN"]`, `[class*="pagination"]`, `[class*="page"]`
    - 성공하면 즉시 반환
  - **방법 2**: 페이지네이션 컨테이너에서 숫자 추출
    - `nav`, `[role="navigation"]`, `[aria-label*="page"]` 등
    - 방법 1 실패 시 시도
  - **방법 3**: 페이지 전체 텍스트에서 패턴 매칭
    - "페이지 1 / 9", "page 1 of 9" 등의 패턴
    - 방법 1, 2 실패 시 시도
  - **방법 4**: 버튼/링크에서 페이지 번호 추출
    - 텍스트와 URL에서 페이지 번호 추출
    - 방법 1, 2, 3 모두 실패 시 시도
- 각 방법에서 찾은 페이지 번호 중 최대값을 마지막 페이지 번호로 설정
- 유효한 범위(1-100)의 페이지 번호만 사용

**예상 소요 시간**: 약 2-3초

**로그 출력 예시**:
```
[4-2] 마지막 페이지 번호 찾는 중...
[방법 1] 특정 CSS 클래스로 페이지 번호 찾기...
✓ 방법 1 성공: 마지막 페이지 번호 = 9
```

**에러 처리**:
- 모든 방법이 실패하면 첫번째 페이지만 사용
- 페이지 구조 분석 정보 출력 (디버깅용)

#### 4-3. 새 탭에서 마지막 페이지 열기

**수행 작업**:
- 마지막 페이지 번호가 1보다 큰 경우에만 실행
- 현재 페이지의 context를 사용하여 새 탭 생성
- 목표 URL 생성: `https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page={lastPageNumber}&limit=300`
- 새 탭에서 목표 URL로 이동
- 페이지 로드 대기 (`domcontentloaded` 상태까지)
- 최종 URL 확인 및 페이지 도달 여부 검증

**예상 소요 시간**: 약 2-3초

**로그 출력 예시**:
```
[4-3 체크] 마지막 페이지 번호(9) 확인 중...
✓ 마지막 페이지 번호(9)가 1보다 크므로 새 탭에서 마지막 페이지를 엽니다.
[4-3] 새로운 탭에서 마지막 페이지(9) 열기...
목표 URL: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page=9&limit=300
✓ 새 탭이 생성되었습니다.
현재 페이지: https://console.publ.biz/channels/L2NoYW5uZWxzLzE3Njkx/orders/subs-products?page=9&limit=300
✓ 마지막 페이지(9)가 새 탭에서 성공적으로 열렸습니다.
  URL 확인: page=9
```

**에러 처리**:
- 새 탭 생성 실패 시 경고 메시지 출력
- 마지막 페이지에 도달하지 못하면 새 탭 닫기
- 마지막 페이지가 첫번째 페이지와 동일하면 이 단계 건너뛰기

#### 4-4. 첫번째 페이지에서 팝업 닫기

**수행 작업**:
- "Key features" 팝업이 있는지 확인
- 팝업이 있으면 닫기 버튼 찾아서 클릭 (여러 방법 시도)
  - X 버튼, aria-label에 "close" 또는 "닫기"가 있는 버튼
  - "Key features" 텍스트 근처의 버튼
  - 닫기 버튼을 찾지 못하면 ESC 키 시도
- 팝업이 닫혔는지 확인

**예상 소요 시간**: 약 1-2초

**로그 출력 예시**:
```
[4-4] 첫번째 페이지에서 팝업 닫기 중...
팝업 확인 중...
✓ "Key features" 팝업이 페이지에 존재합니다.
✓ 닫기 버튼 클릭 완료 (선택자: button[x-pds-name="IconButton"])
✓ 팝업이 성공적으로 닫혔습니다.
```

**에러 처리**:
- 팝업을 닫지 못해도 계속 진행 (경고 메시지 출력)
- 팝업이 없으면 그대로 진행

**참고사항**:
- ⚠️ **팝업 닫기 기능**: 현재 "Key features" 팝업을 자동으로 닫는 기능이 구현되어 있으나, 완벽하게 작동하지 않을 수 있습니다. 팝업 구조가 변경되거나 선택자가 맞지 않으면 수동으로 닫아야 할 수 있습니다.

#### 4-5. 첫번째 페이지에서 CSV 다운로드

**수행 작업**:
- 다양한 선택자로 다운로드 버튼 찾기 시도:
  - 주문 목록 페이지의 특정 다운로드 버튼: `button[x-pds-name="IconButton"]`, `button.sc-fpAkvV.cVarYZ` 등
  - 일반적인 다운로드 버튼: `button:has-text("Download")`, `button:has-text("CSV")` 등
- 버튼이 보이지 않으면 스크롤
- 다운로드 이벤트 대기와 버튼 클릭 동시 실행
- 다운로드 이벤트 감지
- 파일명에 "첫번째" 레이블과 타임스탬프 추가하여 저장

**예상 소요 시간**: 약 2-3초

**로그 출력 예시**:
```
[4-5] 첫번째 페이지 CSV 다운로드 중...
다운로드 버튼 찾는 중 (첫번째 페이지)...
✓ 다운로드 버튼 발견: "..." (선택자: button[x-pds-name="IconButton"])
✓ 다운로드 버튼 클릭 완료
✅ 파일 다운로드 완료: /path/to/downloads/orders_첫번째_2024-11-22T13-45-30.csv
```

**에러 처리**:
- 다운로드 버튼을 찾을 수 없으면 경고 메시지 출력
- 다운로드 이벤트를 감지하지 못하면 다운로드 폴더 확인 (최근 10초 내 생성된 파일)

#### 4-6. 마지막 페이지 탭에서 팝업 닫기

**수행 작업**:
- 마지막 페이지 탭으로 포커스 이동
- "Key features" 팝업이 있는지 확인
- 팝업이 있으면 닫기 버튼 찾아서 클릭 (여러 방법 시도)
  - X 버튼, aria-label에 "close" 또는 "닫기"가 있는 버튼
  - "Key features" 텍스트 근처의 버튼
  - 닫기 버튼을 찾지 못하면 ESC 키 시도
- 팝업이 닫혔는지 확인

**예상 소요 시간**: 약 1-2초

**로그 출력 예시**:
```
[4-6] 마지막 페이지 탭에서 팝업 닫기 중...
팝업 확인 중...
✓ "Key features" 팝업이 페이지에 존재합니다.
✓ 닫기 버튼 클릭 완료 (선택자: button[x-pds-name="IconButton"])
✓ 팝업이 성공적으로 닫혔습니다.
```

**에러 처리**:
- 팝업을 닫지 못해도 계속 진행 (경고 메시지 출력)
- 팝업이 없으면 그대로 진행

#### 4-7. 마지막 페이지 탭에서 CSV 다운로드

**수행 작업**:
- 다양한 선택자로 다운로드 버튼 찾기 시도:
  - 주문 목록 페이지의 특정 다운로드 버튼: `button[x-pds-name="IconButton"]`, `button.sc-fpAkvV.cVarYZ` 등
  - 일반적인 다운로드 버튼: `button:has-text("Download")`, `button:has-text("CSV")` 등
- 버튼이 보이지 않으면 스크롤
- 다운로드 이벤트 대기와 버튼 클릭 동시 실행
- 다운로드 이벤트 감지
- 파일명에 "마지막({페이지번호})" 레이블과 타임스탬프 추가하여 저장

**예상 소요 시간**: 약 2-3초

**로그 출력 예시**:
```
[4-7] 마지막 페이지 탭에서 CSV 다운로드 중...
다운로드 버튼 찾는 중 (마지막(9) 페이지)...
✓ 다운로드 버튼 발견: "..." (선택자: button[x-pds-name="IconButton"])
✓ 다운로드 버튼 클릭 완료
✅ 파일 다운로드 완료: /path/to/downloads/orders_마지막(9)_2024-11-22T13-45-30.csv
```

**에러 처리**:
- 다운로드 버튼을 찾을 수 없으면 경고 메시지 출력
- 다운로드 이벤트를 감지하지 못하면 다운로드 폴더 확인 (최근 10초 내 생성된 파일)

---

### 마지막. 브라우저 유지

**목표**: 사용자가 수동으로 확인할 수 있도록 브라우저 열어두기

> **참고**: 이 단계는 항상 워크플로우의 마지막 단계입니다. 이후 추가되는 모든 목표 단계들은 이 단계 이전에 실행됩니다.

**수행 작업**:
- 브라우저를 닫지 않고 유지
- 무한 대기 상태로 전환
- 사용자가 Ctrl+C로 종료할 때까지 대기

**예상 소요 시간**: 무한 (사용자가 종료할 때까지)

**로그 출력 예시**:
```
브라우저를 열어둡니다. 수동으로 닫아주세요.
작업을 계속하려면 Ctrl+C를 눌러 스크립트를 종료하세요.
```

---

## ⚠️ 에러 처리 및 복구

### 전체 프로세스 중 에러 발생 시

1. **스크린샷 저장**: `error-screenshot.png`에 오류 발생 시점의 화면 저장
2. **에러 메시지 출력**: 상세한 에러 메시지와 스택 트레이스 출력
3. **브라우저 종료**: 오류 발생 시 브라우저 자동 종료

### 단계별 에러 처리

각 단계에서 에러가 발생하면:
- 가능한 경우 경고 메시지 출력 후 다음 단계로 진행
- 치명적인 에러인 경우 프로세스 종료
- 디버깅을 위한 상세 정보 출력 (요소 목록, 페이지 정보 등)

---

## 📊 성능 지표

| 목표 | 단계 | 예상 소요 시간 | 누적 시간 |
|------|------|---------------|-----------|
| 1. 초기화 및 환경 설정 | - | 2초 | 2초 |
| 2. 로그인하기 | 2-1. 로그인 정보 확인 | 즉시 | 2초 |
| | 2-2. 로그인 페이지 접속 | 3초 | 5초 |
| | 2-3. 로그인 정보 입력 | 1초 | 6초 |
| | 2-4. 로그인 버튼 클릭 | 0.5초 | 6.5초 |
| | 2-5. 로그인 결과 확인 | 3초 | 9.5초 |
| 3. 회원 정보 CSV 파일 다운로드 | 3-1. 목표 페이지로 이동 | 2초 | 11.5초 |
| | 3-2. 다운로드 버튼 찾기 및 클릭 | 2초 | 13.5초 |
| | 3-3. 파일 저장 | 즉시 | 13.5초 |
| 4. 주문 목록 CSV 파일 다운로드 | 4-1. 첫번째 페이지로 이동 | 2초 | 15.5초 |
| | 4-2. 마지막 페이지 번호 찾기 | 2-3초 | 17.5-18.5초 |
| | 4-3. 새 탭에서 마지막 페이지 열기 | 2-3초 | 19.5-21.5초 |
| | 4-4. 첫번째 페이지에서 팝업 닫기 | 1-2초 | 20.5-23.5초 |
| | 4-5. 첫번째 페이지에서 CSV 다운로드 | 2-3초 | 22.5-26.5초 |
| | 4-6. 마지막 페이지 탭에서 팝업 닫기 | 1-2초 | 23.5-28.5초 |
| | 4-7. 마지막 페이지 탭에서 CSV 다운로드 | 2-3초 | 25.5-31.5초 |
| 마지막. 브라우저 유지 | - | 무한 | - |

**전체 자동화 시간**: 약 25-35초 (네트워크 상태, 페이지 수, 팝업 처리 시간에 따라 변동)

---

## 🔄 워크플로우 다이어그램

```
시작
  ↓
[1] 초기화 및 환경 설정
  ↓
[2] 로그인하기
  ├─ [2-1] 로그인 정보 확인 (정보 없음 → 종료)
  ├─ [2-2] 로그인 페이지 접속
  ├─ [2-3] 로그인 정보 입력
  │   ├─ 이메일 입력
  │   └─ 비밀번호 입력
  ├─ [2-4] 로그인 버튼 클릭
  └─ [2-5] 로그인 결과 확인 (실패 → 종료)
  ↓
[3] 회원 정보 CSV 파일 다운로드
  ├─ [3-1] 목표 페이지로 이동
  ├─ [3-2] 다운로드 버튼 찾기 및 클릭
  └─ [3-3] 파일 저장 (타임스탬프 추가)
  ↓
[4] 주문 목록 CSV 파일 다운로드
  ├─ [4-1] 첫번째 페이지로 이동
  ├─ [4-2] 마지막 페이지 번호 찾기 (4가지 방법 순차 시도)
  ├─ [4-3] 새 탭에서 마지막 페이지 열기
  ├─ [4-4] 첫번째 페이지에서 팝업 닫기
  ├─ [4-5] 첫번째 페이지에서 CSV 다운로드
  ├─ [4-6] 마지막 페이지 탭에서 팝업 닫기
  └─ [4-7] 마지막 페이지 탭에서 CSV 다운로드
  ↓
(추가 목표 단계들...)
  ↓
[마지막] 브라우저 유지 (사용자 종료 대기)
  ↓
종료 (Ctrl+C)
```

---

## 📝 주요 특징

### 1. 견고한 요소 찾기
- 각 입력 필드와 버튼에 대해 여러 선택자 시도
- 실패 시 다음 선택자로 자동 전환

### 2. 중복 방지
- 다운로드 파일명에 타임스탬프 자동 추가
- 같은 파일을 여러 번 다운로드해도 덮어쓰기 방지

### 3. 상세한 로깅
- 각 단계별 진행 상황 실시간 출력
- 성공/실패 상태 명확히 표시
- 디버깅을 위한 상세 정보 제공

### 4. 에러 복구
- 일부 단계 실패 시에도 가능한 한 계속 진행
- 치명적인 에러만 프로세스 종료
- 에러 발생 시 스크린샷 자동 저장

### 5. 사용자 친화적
- 브라우저를 열어두어 수동 확인 가능
- 마스킹 처리된 로그인 정보 출력
- 명확한 에러 메시지 및 해결 방법 제시

---

## 🔧 설정 가능한 옵션

### 브라우저 설정
- **헤드리스 모드**: `false` (브라우저 창 표시)
- **slowMo**: `100ms` (각 동작 사이 지연)
- **뷰포트**: `1280x800`

### 타임아웃 설정
- 페이지 로드: `60초`
- 요소 대기: `3-10초` (요소별 상이)
- 다운로드 이벤트: `15초`

### 다운로드 설정
- **다운로드 경로**: `./downloads`
- **파일명 형식**: `[원본파일명]_[YYYY-MM-DDTHH-MM-SS].[확장자]`

---

## 📁 파일 구조 및 역할

이 프로젝트는 모듈화된 구조로 각 단계를 독립적인 파일로 분리하여 관리합니다.

### 메인 실행 파일

| 파일명 | 역할 | 설명 |
|--------|------|------|
| `main.js` | 전체 워크플로우 실행 | 모든 모듈을 순차적으로 실행하는 메인 엔트리 포인트. 전체 자동화 프로세스를 조율합니다. |
| `login.js` | 기존 통합 스크립트 | 호환성을 위해 유지되는 기존 통합 로그인 스크립트. 모든 기능을 하나의 파일에 포함합니다. |

### 모듈 파일 (modules/)

| 파일명 | 단계 | 역할 | 주요 함수 |
|--------|------|------|-----------|
| `modules/browser-init.js` | 1단계 | 브라우저 초기화 및 환경 설정 | `initializeBrowser()` - Chromium 브라우저 실행, 다운로드 경로 설정, 브라우저 창 크기 조정 |
| `modules/login.js` | 2단계 | 로그인 프로세스 관리 | `getLoginCredentials()` - 환경변수에서 로그인 정보 가져오기<br>`performLogin()` - 전체 로그인 프로세스 실행<br>`navigateToLoginPage()` - 로그인 페이지 이동<br>`fillLoginForm()` - 로그인 폼 입력<br>`clickLoginButton()` - 로그인 버튼 클릭<br>`verifyLoginResult()` - 로그인 결과 확인 |
| `modules/download-members.js` | 3단계 | 회원 정보 CSV 파일 다운로드 | `downloadMembersCSV()` - 회원 정보 다운로드 전체 프로세스<br>`navigateToMembersPage()` - 회원 정보 페이지로 이동<br>`findAndClickDownloadButton()` - 다운로드 버튼 찾기 및 클릭 |
| `modules/download-orders.js` | 4단계 | 주문 목록 CSV 파일 다운로드 | `downloadOrdersCSV()` - 주문 목록 CSV 다운로드 전체 프로세스<br>`navigateToFirstOrderPage()` - 첫번째 페이지로 이동 (4-1)<br>`findLastPageNumber()` - 마지막 페이지 번호 찾기 (4-2, 4가지 방법 순차 시도)<br>`openLastPageInNewTab()` - 새 탭에서 마지막 페이지 열기 (4-3)<br>`closeKeyFeaturesPopup()` - "Key features" 팝업 닫기 (4-4, 4-6)<br>`downloadCSVFromPage()` - CSV 다운로드 실행 (4-5, 4-7) |
| `modules/keep-browser.js` | 마지막 | 브라우저 유지 | `keepBrowserOpen()` - 브라우저를 열어두고 사용자 종료 대기 |

### 유틸리티 파일 (utils/)

| 파일명 | 역할 | 주요 함수 |
|--------|------|-----------|
| `utils/download-helpers.js` | 다운로드 관련 유틸리티 함수 | `downloadCSVFromPage()` - CSV 다운로드 헬퍼 함수 (버튼 찾기, 클릭, 파일 저장)<br>`getRecentDownloadedFiles()` - 최근 다운로드된 파일 확인 |

### 테스트 및 유지보수 파일

| 파일명 | 역할 | 사용 방법 |
|--------|------|-----------|
| `test-modules.js` | 개별 모듈 테스트 스크립트 | `node test-modules.js <module-name>`<br>예: `node test-modules.js login`<br>각 모듈을 독립적으로 테스트할 수 있습니다. |
| `step4-orders-download.js` | 참고용 (이전 버전) | 개발 과정에서 참고용으로 남겨둔 파일입니다. 실제 실행에는 사용되지 않습니다. |

### 파일 실행 흐름

```
main.js (시작)
  ↓
modules/browser-init.js (1단계: 브라우저 초기화)
  ↓
modules/login.js (2단계: 로그인)
  ↓
modules/download-members.js (3단계: 회원 정보 다운로드)
  └─ utils/download-helpers.js (다운로드 헬퍼 사용)
  ↓
modules/download-orders.js (4단계: 주문 목록 CSV 다운로드)
  └─ utils/download-helpers.js (다운로드 헬퍼 사용)
  ↓
modules/keep-browser.js (마지막: 브라우저 유지)
  ↓
종료 (Ctrl+C)
```

### 모듈 사용 방법

#### 전체 워크플로우 실행
```bash
npm start
# 또는
node main.js
```

#### 개별 모듈 테스트
```bash
# 브라우저 초기화만 테스트
node test-modules.js browser-init

# 로그인만 테스트
node test-modules.js login

# 회원 정보 다운로드만 테스트 (로그인 후)
node test-modules.js download-members

# 주문 목록 다운로드만 테스트 (로그인 후)
node test-modules.js download-orders
```

### 모듈화의 장점

1. **독립 테스트**: 각 모듈을 개별적으로 테스트 가능
2. **코드 재사용**: 모듈을 다른 프로젝트에서도 활용 가능
3. **유지보수 용이**: 특정 기능만 수정 시 해당 모듈만 변경
4. **확장성**: 새로운 단계 추가 시 새 모듈만 추가하면 됨
5. **가독성**: 코드 구조가 명확하고 이해하기 쉬움

---

## 📌 참고사항

- 이 자동화는 publ.biz 웹사이트의 구조에 의존합니다
- 웹사이트 구조가 변경되면 선택자를 업데이트해야 할 수 있습니다
- 네트워크 상태에 따라 소요 시간이 변동될 수 있습니다
- 로그인 세션이 만료되면 재실행이 필요합니다
- 모듈 구조에 대한 상세한 내용은 `MODULES.md` 파일을 참조하세요

---

**마지막 업데이트**: 2024-11-22  
**버전**: 2.0.0 (모듈화)

